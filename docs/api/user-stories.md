# User Stories

## 1. 상품 관리

### US-001: 상품 정보 조회
**As a** 고객  
**I want** 상품의 가격과 재고 정보를 조회할 수 있다  
**So that** 구매 가능 여부를 확인하고 구매 결정을 할 수 있다

**Acceptance Criteria:**
- [ ] 상품 ID로 특정 상품의 상세 정보를 조회할 수 있다
- [ ] 조회 결과에 상품명, 가격, 재고 수량이 포함되어 있다
- [ ] 존재하지 않는 상품 ID로 조회 시 적절한 에러 메시지를 반환한다
- [ ] 응답 시간은 평균 100ms 이내여야 한다

---

### US-002: 재고 실시간 확인
**As a** 고객  
**I want** 상품의 재고를 실시간으로 확인할 수 있다  
**So that** 품절 상품에 대한 불필요한 주문 시도를 방지할 수 있다

**Acceptance Criteria:**
- [ ] 상품 조회 시 현재 시점의 실제 재고 수량이 표시된다
- [ ] 재고가 0인 경우 품절 상태로 표시된다
- [ ] 동시에 여러 사용자가 조회해도 정확한 재고 정보를 제공한다
- [ ] 재고 정보는 캐싱 없이 실시간으로 조회된다

---

### US-003: 인기 상품 통계 조회
**As a** 고객  
**I want** 최근 3일간 가장 많이 팔린 상품 Top 5를 확인할 수 있다  
**So that** 인기 있는 상품을 참고하여 구매 결정에 도움을 받을 수 있다

**Acceptance Criteria:**
- [ ] 최근 3일간 판매량 기준 상위 5개 상품이 조회된다
- [ ] 각 상품의 판매량 정보가 함께 표시된다
- [ ] 판매량이 동일한 경우 최근 판매된 상품이 우선한다
- [ ] 통계는 매 시간마다 갱신된다

---

## 2. 주문/결제 시스템

### US-004: 장바구니 상품 추가
**As a** 고객  
**I want** 원하는 상품을 장바구니에 담을 수 있다  
**So that** 여러 상품을 한 번에 주문할 수 있다

**Acceptance Criteria:**
- [ ] 상품 ID와 수량을 지정하여 장바구니에 추가할 수 있다
- [ ] 이미 장바구니에 있는 상품을 추가하면 수량이 증가한다
- [ ] 재고보다 많은 수량은 추가할 수 없다
- [ ] 장바구니 내역은 사용자별로 독립적으로 관리된다

---

### US-005: 장바구니 조회 및 관리
**As a** 고객  
**I want** 내 장바구니에 담긴 상품 목록을 확인하고 수정할 수 있다  
**So that** 주문 전에 장바구니 내용을 검토하고 조정할 수 있다

**Acceptance Criteria:**
- [ ] 장바구니에 담긴 모든 상품과 수량을 조회할 수 있다
- [ ] 각 상품의 현재 가격과 소계가 표시된다
- [ ] 장바구니에서 상품을 삭제할 수 있다
- [ ] 장바구니 상품의 수량을 변경할 수 있다

---

### US-006: 주문 생성 및 재고 차감
**As a** 고객  
**I want** 장바구니의 상품을 주문할 수 있다  
**So that** 상품을 구매하고 배송받을 수 있다

**Acceptance Criteria:**
- [ ] 장바구니의 모든 상품에 대해 주문이 생성된다
- [ ] 주문 생성과 동시에 각 상품의 재고가 차감된다
- [ ] 재고가 부족한 상품이 하나라도 있으면 주문 전체가 실패한다
- [ ] 재고 확인과 차감은 원자적으로 처리되어 동시성 문제를 방지한다
- [ ] 주문 실패 시 차감된 재고는 자동으로 복구된다

---

### US-007: 잔액 기반 결제
**As a** 고객  
**I want** 내 계정 잔액으로 주문 금액을 결제할 수 있다  
**So that** 신속하게 구매를 완료할 수 있다

**Acceptance Criteria:**
- [ ] 사용자의 현재 잔액을 조회할 수 있다
- [ ] 주문 금액만큼 잔액이 차감된다
- [ ] 잔액이 부족한 경우 결제가 실패하고 적절한 에러 메시지가 표시된다
- [ ] 결제 실패 시 재고는 자동으로 복구된다
- [ ] 결제와 재고 차감은 트랜잭션으로 처리되어 일관성을 보장한다

---

### US-008: 쿠폰 할인 적용
**As a** 고객  
**I want** 보유한 쿠폰을 주문 시 적용할 수 있다  
**So that** 할인된 가격으로 상품을 구매할 수 있다

**Acceptance Criteria:**
- [ ] 주문 시 쿠폰 코드를 입력하여 할인을 적용할 수 있다
- [ ] 쿠폰 할인이 적용된 최종 결제 금액이 계산된다
- [ ] 유효하지 않거나 만료된 쿠폰은 사용할 수 없다
- [ ] 이미 사용된 쿠폰은 재사용할 수 없다
- [ ] 쿠폰 사용 후 해당 쿠폰은 사용 완료 상태로 변경된다

---

## 3. 쿠폰 시스템

### US-009: 선착순 쿠폰 발급
**As a** 고객  
**I want** 한정 수량의 쿠폰을 선착순으로 발급받을 수 있다  
**So that** 할인 혜택을 받을 수 있다

**Acceptance Criteria:**
- [ ] 쿠폰 발급 요청 시 선착순으로 쿠폰이 발급된다
- [ ] 한정 수량이 모두 소진되면 쿠폰 발급이 불가능하다
- [ ] 동시에 많은 사용자가 요청해도 정확한 수량만큼만 발급된다
- [ ] 이미 쿠폰을 발급받은 사용자는 중복 발급할 수 없다
- [ ] 발급된 쿠폰은 사용자 계정에 저장된다

---

### US-010: 쿠폰 유효성 검증
**As a** 시스템  
**I want** 쿠폰 사용 시 유효성을 검증할 수 있다  
**So that** 잘못된 쿠폰 사용을 방지할 수 있다

**Acceptance Criteria:**
- [ ] 쿠폰 코드의 존재 여부를 확인한다
- [ ] 쿠폰의 유효 기간을 검증한다
- [ ] 쿠폰의 사용 여부를 확인한다
- [ ] 쿠폰 소유자가 요청한 사용자와 일치하는지 확인한다
- [ ] 검증 실패 시 구체적인 실패 사유를 반환한다

---

### US-011: 쿠폰 사용 이력 관리
**As a** 고객  
**I want** 내 쿠폰 발급 및 사용 이력을 확인할 수 있다  
**So that** 보유한 쿠폰과 사용한 쿠폰을 관리할 수 있다

**Acceptance Criteria:**
- [ ] 현재 사용 가능한 쿠폰 목록을 조회할 수 있다
- [ ] 이미 사용한 쿠폰 이력을 조회할 수 있다
- [ ] 각 쿠폰의 할인 금액/비율, 유효기간이 표시된다
- [ ] 만료된 쿠폰도 이력에서 확인할 수 있다

---

## 4. 데이터 연동

### US-012: 주문 데이터 외부 전송
**As a** 시스템 관리자  
**I want** 완료된 주문 데이터가 외부 시스템으로 자동 전송된다  
**So that** 외부 시스템과 주문 정보를 동기화할 수 있다

**Acceptance Criteria:**
- [ ] 주문이 성공적으로 완료되면 자동으로 외부 시스템으로 데이터를 전송한다
- [ ] 전송 데이터에는 주문 ID, 상품 정보, 결제 금액 등이 포함된다
- [ ] 외부 시스템 전송 실패 시에도 주문은 정상적으로 처리된다
- [ ] 전송 실패한 데이터는 별도로 기록되어 재시도할 수 있다
- [ ] 데이터 전송은 비동기로 처리되어 주문 처리 속도에 영향을 주지 않는다

---

### US-013: 외부 연동 실패 처리
**As a** 시스템  
**I want** 외부 시스템 연동 실패 시에도 주문은 정상 처리된다  
**So that** 외부 시스템 장애가 주문 처리에 영향을 주지 않는다

**Acceptance Criteria:**
- [ ] 외부 시스템 응답 실패 시 주문은 정상적으로 완료된다
- [ ] 외부 시스템 타임아웃 시에도 주문 처리가 계속된다
- [ ] 실패한 전송은 로그에 기록된다
- [ ] 실패한 데이터는 별도 큐에 저장되어 재전송을 시도한다
- [ ] 재시도는 exponential backoff 방식으로 처리된다

---

## 5. 사용자 관리

### US-014: 잔액 충전
**As a** 고객  
**I want** 내 계정에 잔액을 충전할 수 있다  
**So that** 상품 구매를 위한 결제 수단을 확보할 수 있다

**Acceptance Criteria:**
- [ ] 충전할 금액을 지정할 수 있다
- [ ] 충전 후 잔액이 즉시 반영된다
- [ ] 충전 이력이 기록된다
- [ ] 최소/최대 충전 금액 제한이 적용된다
- [ ] 충전 실패 시 적절한 에러 메시지가 표시된다

---

### US-015: 잔액 조회
**As a** 고객  
**I want** 내 계정의 현재 잔액을 확인할 수 있다  
**So that** 구매 가능한 금액을 파악할 수 있다

**Acceptance Criteria:**
- [ ] 현재 사용 가능한 잔액을 조회할 수 있다
- [ ] 잔액 변동 이력을 확인할 수 있다 (충전, 사용)
- [ ] 각 이력의 날짜, 금액, 거래 유형이 표시된다
- [ ] 조회 결과는 실시간 데이터를 반영한다
